/*!
* jQuery Text Captcha Plugin
* Copyright (c) 2012 Brian Ray
* Version: 0.3 (02-SEP-2012)
* Licensed under the Phil Sturgeon's DBAD license.
* Requires: jQuery v1.4.2 or later
*/(function($){function log(){window.console&&console.log&&console.log("[captcha] "+Array.prototype.join.call(arguments," "))}var ver="0.4";$.fn.textCaptcha=function(e){var t={type:"text",method:"alphabetic",length:4,target:null};var e=$.extend(t,e);return this.each(function(){function d(){e.type=i[Math.floor(Math.random()*i.length)];e.method="random"}function v(){switch(e.type){case"text":e.method=s[Math.floor(Math.random()*s.length)];break;case"math":e.method=o[Math.floor(Math.random()*o.length)];break;case"number":e.method=u[Math.floor(Math.random()*u.length)];break}}function m(){switch(e.type){case"text":for(var i=0;i<e.length;i++){f+=t[Math.floor(Math.random()*t.length)]}break;case"math":a=r[e.method];l=n[Math.floor(Math.random()*n.length)];c=n[Math.floor(Math.random()*n.length)];f=l+" "+a+" "+c;break;case"number":for(i=0;i<e.length;i++){f+=n[Math.floor(Math.random()*n.length)]}break}}function g(t){var r="";for(var i=0;i<n.length;i++){r+=n[Math.floor(Math.random()*n.length)]}var s='<p><span id="type_captcha_method_'+r+'">'+h+'</span>: <span id="captcha">'+f+"</span></p>";s+='<input type="text" id="captcha_user_'+r+'" name="captcha_user" />';s+='<input type="hidden" id="captcha_type_'+r+'" name="captcha_type" value="'+e.type+'" />';s+='<input type="hidden" id="captcha_method_'+r+'" name="captcha_method" value="'+e.method+'" />';s+='<input type="hidden" id="captcha_value_'+r+'" name="captcha_value" value="'+f+'" />';if(e.target===null){t.find(":submit").before(s)}else{$(e.target).append(s)}}function y(){if($.inArray(e.method,p)<0){log("Type, method mismatch. \n type: "+e.type+" \n method: "+e.method);return false}}var t=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],n=[0,1,2,3,4,5,6,7,8,9],r={add:"+",subtract:"-",multiply:"*"},i=["text","math","number"],s=["alphabetic","backwards","reverse_alphabetic"],o=["add","subtract","multiply"],u=["numeric","reverse_numeric"],a="",f="",l,c,h;if(e.type==="random"){d()}var p;switch(e.type){case"text":p=s;break;case"math":p=o;break;case"number":p=u;break}if(e.method==="random"){v()}m();y();switch(e.method){case"backwards":h="Type this string backwards";break;case"alphabetic":h="Type this string in alphabetical order";break;case"reverse_alphabetic":h="Type this string in reverse alphabetical order";break;case"add":h="Add these numbers";break;case"subtract":h="Subtract these numbers";break;case"multiply":h="Multiply these numbers";break;case"numeric":h="Put these numbers in numeric order";break;case"reverse_numeric":h="Put these numbers in reverse numeric order";break}g($(this))})};$.fn.textCaptchaCheck=function(){var $this=$(this);var value,correct_value="",captcha_type=$this.find('input[name="captcha_type"]').val(),captcha_method=$this.find('input[name="captcha_method"]').val(),captcha_user=$this.find('input[name="captcha_user"]').val();if(captcha_type==="text"||captcha_type==="number"){value=$this.find('input[name="captcha_value"]').val().split("")}else{value=$this.find('input[name="captcha_value"]').val();captcha_user=parseInt(captcha_user,10)}switch(captcha_method){case"alphabetic":value=value.sort();break;case"backwards":value=value.reverse();break;case"reverse_alphabetic":value=value.sort();value=value.reverse();break;case"add":value=parseInt(eval(value),10);break;case"subtract":value=parseInt(eval(value),10);break;case"multiply":value=parseInt(eval(value),10);break;case"numeric":value=value.sort(function(e,t){return e-t});break;case"reverse_numeric":value=value.sort(function(e,t){return e-t});value=value.reverse();break}if(captcha_type==="text"||captcha_type==="number"){correct_value=value.join("")}else{correct_value=value}if(captcha_user!==correct_value){return false}else{return true}}})(jQuery)    
